@model FreelancerCLone.DbModels.Project

@{
    ViewData["Title"] = "Details";

    int approvedId = ViewBag.ApprovedId;
}

<h1>Details</h1>

<p>
    <a data-toggle="modal" class="btn btn-primary" data-target="#ProjectBidModal" onclick="addProjectBidCategory(@Model.Id)">Bid</a>
</p>
<div id="addDiv"></div>
<div>
    <h4>Project</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Title)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Title)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Description)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Description)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Budget)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Budget)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Deadline)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Deadline)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.TechnologyRequired)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.TechnologyRequired)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.AddedOn)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.AddedOn)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.UpdatedOn)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.UpdatedOn)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.IsAssigned)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.IsAssigned)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.IsActive)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.IsActive)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.AddedByNavigation)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.AddedByNavigation.Id)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.StatusNavigation)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.StatusNavigation.Id)
        </dd>
    </dl>
</div>


@if (Model.AddedByNavigation.UserNavigation.UserName == User.Identity.Name)
{
    var assigned = Model.ProjectBids.Where(x => x.Status == approvedId).FirstOrDefault();

    if (assigned == null)
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Bid Amount</th>
                    <th>Days Required</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var b in Model.ProjectBids)
                {
                    <tr>
                        <td>@b.User.FirstName @b.User.LastName</td>
                        <td>@b.BidBudget</td>
                        <td>@b.BidDeadline</td>
                        <td>
                            <a class="btn btn-success" asp-action="ApproveBid" asp-route-BidId="@b.Id" asp-route-ProjectId="@Model.Id">Approve</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div>
            <strong>Project Assigned to @assigned.User.FirstName @assigned.User.LastName</strong>
        </div>

    }
}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function addProjectBidCategory(Id) {
        $.ajax({
            type: "Get",
            url: "/Project/BidProject",
            data: { Id: Id },
            success: function (result) {
                $("#addDiv").html(result);
                $("#ProjectBidModal").modal('show');
            }
        })
    }
</script>